{
  "chapter": 22,
  "title": "Inline Assembly",
  "fls_url": "https://rust-lang.github.io/fls/inline-assembly.html",
  "fls_id": "fls_z1il3w9nulzy",
  "repository": "eclipse-iceoryx/iceoryx2",
  "version": "0.8.0",
  "analysis_date": "2025-12-30",
  "version_changes": {
    "from_version": "0.7.0",
    "to_version": "0.8.0",
    "summary": "Still NO inline assembly in core library. One global_asm! in bare-metal example for ARM startup. Fence usage slightly decreased as atomics restructured.",
    "key_changes": [
      "asm! macro: 0 \u2192 0 (unchanged)",
      "global_asm! macro: 0 \u2192 1 (bare-metal example only)",
      "naked_asm! macro: 0 \u2192 0 (unchanged)",
      "fence() usage: 12 \u2192 11 (-8%)",
      "compiler_fence() usage: 8 \u2192 8 (unchanged)",
      "Atomic wrapper types restructured in iceoryx2-bb/concurrency",
      "Memory ordering total: 816 \u2192 848 (+4%)"
    ]
  },
  "summary": "iceoryx2 v0.8.0 introduces minimal inline assembly usage exclusively in bare-metal no_std examples for ARM architecture. The main codebase remains assembly-free for portability. Memory fences (compiler_fence and hardware fence) are used extensively in lock-free data structures for memory ordering.",
  "statistics": {
    "asm_macro": 1,
    "global_asm_macro": 1,
    "naked_asm_macro": 0,
    "compiler_fence": 8,
    "hardware_fence": 11,
    "spin_loop_hints": 12
  },
  "sections": {
    "registers": {
      "fls_section": "22.1",
      "fls_ids": [
        "fls_j9l8wn6wgm06"
      ],
      "description": "Registers",
      "status": "limited_use",
      "findings": {
        "description": "Register usage limited to bare-metal ARM example using r0/r1 for syscall",
        "usage_context": "ARM semihosting syscall only"
      },
      "samples": [
        {
          "file": "examples/nostd/bare-metal/rust/_common/src/semihosting.rs",
          "line": [
            19,
            20,
            21,
            22
          ],
          "code": "core::arch::asm!(\"svc 0x123456\", inout(\"r0\") operation => result, in(\"r1\") arg, options(nostack));",
          "purpose": "ARM semihosting syscall with r0/r1 register bindings"
        },
        {
          "file": "examples/nostd/bare-metal/rust/publish-subscribe/src/startup.rs",
          "line": [
            13
          ],
          "code": "core::arch::global_asm!(",
          "purpose": "Demonstrates asm!..."
        }
      ],
      "count": 2,
      "samples_waiver": {
        "reason": "insufficient_patterns",
        "explanation": "Only 2 instance(s) found in codebase, fewer than 3 required samples",
        "approved_by": "automated",
        "date": "2025-12-30"
      }
    },
    "register_classes": {
      "fls_section": "22.2",
      "fls_ids": [
        "fls_pz2ioqchjtym"
      ],
      "description": "Register Classes",
      "status": "not_used",
      "findings": {
        "description": "No register class specifiers found. Uses explicit named registers."
      },
      "samples": [],
      "count": null,
      "count_methodology": "Pattern not defined for this section"
    },
    "register_arguments": {
      "fls_section": "22.3",
      "fls_ids": [
        "fls_hejgghwzblf"
      ],
      "description": "Register Arguments",
      "status": "limited_use",
      "findings": {
        "patterns": [
          "inout(\"r0\") for bidirectional",
          "in(\"r1\") for input-only"
        ]
      },
      "samples": [
        {
          "file": "examples/nostd/bare-metal/rust/_common/src/semihosting.rs",
          "line": [
            21,
            22
          ],
          "code": "inout(\"r0\") operation => result, in(\"r1\") arg,",
          "purpose": "Bidirectional and input register arguments"
        },
        {
          "file": "examples/nostd/bare-metal/rust/publish-subscribe/src/startup.rs",
          "line": [
            13
          ],
          "code": "core::arch::global_asm!(",
          "purpose": "Demonstrates asm!..."
        }
      ],
      "count": 2,
      "samples_waiver": {
        "reason": "insufficient_patterns",
        "explanation": "Only 2 instance(s) found in codebase, fewer than 3 required samples",
        "approved_by": "automated",
        "date": "2025-12-30"
      }
    },
    "assembly_instructions": {
      "fls_section": "22.4",
      "fls_ids": [
        "fls_e0896uk0mdyl"
      ],
      "description": "Assembly Instructions",
      "status": "limited_use",
      "findings": {
        "instructions": [
          "svc 0x123456 - ARM supervisor call",
          "LDR - Load register",
          "bl - Branch with link"
        ]
      },
      "samples": [
        {
          "file": "examples/nostd/bare-metal/rust/_common/src/semihosting.rs",
          "line": [
            20
          ],
          "code": "\"svc 0x123456\",",
          "purpose": "ARM supervisor call for semihosting"
        },
        {
          "file": "examples/nostd/bare-metal/rust/publish-subscribe/src/startup.rs",
          "line": [
            13
          ],
          "code": "core::arch::global_asm!(",
          "purpose": "Demonstrates asm!..."
        }
      ],
      "subsections": {
        "register_parameter_modifiers": {
          "fls_section": "22.4.1",
          "fls_ids": [
            "fls_lv19xysy1f7e"
          ],
          "description": "Register Parameter Modifiers",
          "status": "limited_use",
          "findings": {
            "description": "Register parameter modifiers specify how values are passed to/from assembly. iceoryx2 uses 'inout' and 'in' modifiers in bare-metal example.",
            "modifiers_used": [
              "inout",
              "in"
            ]
          },
          "samples": [
            {
              "file": "examples/nostd/bare-metal/rust/_common/src/semihosting.rs",
              "line": [
                21,
                22
              ],
              "code": "inout(\"r0\") operation => result, in(\"r1\") arg,",
              "purpose": "inout for bidirectional r0, in for input-only r1"
            },
            {
              "file": "examples/nostd/bare-metal/rust/publish-subscribe/src/startup.rs",
              "line": [
                13
              ],
              "code": "core::arch::global_asm!(",
              "purpose": "Demonstrates asm!..."
            }
          ],
          "count": 2,
          "samples_waiver": {
            "reason": "insufficient_patterns",
            "explanation": "Only 2 instance(s) found in codebase, fewer than 3 required samples",
            "approved_by": "automated",
            "date": "2025-12-30"
          }
        },
        "directive_support": {
          "fls_section": "22.4.2",
          "fls_ids": [
            "fls_6momhvgx4w21"
          ],
          "description": "Directive Support",
          "status": "limited_use",
          "findings": {
            "description": "Assembly directives provide additional context to the assembler. iceoryx2 uses .section directive in global_asm! for bare-metal startup.",
            "directives_used": [
              ".section"
            ]
          },
          "samples": [
            {
              "file": "examples/nostd/bare-metal/rust/publish-subscribe/src/startup.rs",
              "line": [
                14
              ],
              "code": ".section .text.startup",
              "purpose": "Places startup code in specific section"
            },
            {
              "file": "examples/nostd/bare-metal/rust/_common/src/semihosting.rs",
              "line": [
                19
              ],
              "code": "core::arch::asm!(",
              "purpose": "Demonstrates asm!..."
            }
          ],
          "count": 2,
          "samples_waiver": {
            "reason": "insufficient_patterns",
            "explanation": "Only 2 instance(s) found in codebase, fewer than 3 required samples",
            "approved_by": "automated",
            "date": "2025-12-30"
          }
        }
      },
      "count": 2,
      "samples_waiver": {
        "reason": "insufficient_patterns",
        "explanation": "Only 2 instance(s) found in codebase, fewer than 3 required samples",
        "approved_by": "automated",
        "date": "2025-12-30"
      }
    },
    "abi_clobbers": {
      "fls_section": "22.5",
      "fls_ids": [
        "fls_a3joqzqp1v9d"
      ],
      "description": "ABI Clobbers",
      "status": "not_used",
      "findings": {
        "description": "No explicit clobber lists found"
      },
      "samples": [],
      "count": null,
      "count_methodology": "Pattern not defined for this section"
    },
    "assembly_options": {
      "fls_section": "22.6",
      "fls_ids": [
        "fls_ylli0ortyegk"
      ],
      "description": "Assembly Options",
      "status": "limited_use",
      "findings": {
        "options_found": [
          "nostack"
        ]
      },
      "samples": [
        {
          "file": "examples/nostd/bare-metal/rust/_common/src/semihosting.rs",
          "line": [
            23
          ],
          "code": "options(nostack)",
          "purpose": "Indicates assembly does not use stack"
        }
      ],
      "count": null,
      "count_methodology": "Pattern not defined for this section",
      "samples_waiver": {
        "reason": "conceptual_section",
        "explanation": "This section describes an abstract concept not directly mappable to concrete code patterns",
        "approved_by": "automated",
        "date": "2025-12-30"
      }
    },
    "macros_asm_global_asm_and_naked_asm": {
      "fls_section": "22.7",
      "fls_ids": [
        "fls_qezwyridmjob"
      ],
      "description": "Macros: asm, global_asm, and naked_asm",
      "status": "limited_use",
      "findings": {
        "asm": 1,
        "global_asm": 1,
        "naked_asm": 0,
        "location": "examples/nostd/bare-metal/rust/ only"
      },
      "samples": [
        {
          "file": "examples/nostd/bare-metal/rust/_common/src/semihosting.rs",
          "line": [
            17,
            18,
            19
          ],
          "code": "core::arch::asm!(\"svc 0x123456\", ...)",
          "purpose": "asm! macro for ARM semihosting syscall"
        },
        {
          "file": "examples/nostd/bare-metal/rust/publish-subscribe/src/startup.rs",
          "line": [
            13,
            14,
            15
          ],
          "code": "core::arch::global_asm!(r#\".section .text.startup...\"#);",
          "purpose": "global_asm! for ARM bare-metal startup code"
        }
      ],
      "safety_notes": [
        "All inline assembly confined to bare-metal examples, not production code",
        "asm! properly marked unsafe"
      ],
      "count": null,
      "count_methodology": "Pattern not defined for this section",
      "samples_waiver": {
        "reason": "conceptual_section",
        "explanation": "This section describes an abstract concept not directly mappable to concrete code patterns",
        "approved_by": "automated",
        "date": "2025-12-30"
      }
    },
    "label_block": {
      "fls_section": "22.8",
      "fls_ids": [],
      "description": "Label block",
      "status": "not_used",
      "findings": {
        "description": "Label blocks in inline assembly allow defining named labels for branching. iceoryx2 does not use label blocks - the minimal assembly in bare-metal examples uses only simple instructions without labels."
      },
      "samples": [],
      "count": null,
      "count_methodology": "Pattern not defined for this section"
    }
  },
  "cross_chapter_references": {
    "chapter_17": "Concurrency - Atomics section covers atomic wrapper types",
    "chapter_19": "Unsafety - Documents 0 asm! usage in library",
    "chapter_21": "FFI - POSIX APIs used instead of asm for platform operations"
  }
}
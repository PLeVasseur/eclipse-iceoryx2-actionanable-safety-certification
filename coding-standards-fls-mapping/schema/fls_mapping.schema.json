{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/eclipse-iceoryx/iceoryx2/coding-standards-fls-mapping/schema/fls_mapping.schema.json",
  "title": "Coding Standard to FLS Mapping",
  "description": "Schema for mapping coding standard guidelines (MISRA/CERT) to Ferrocene Language Specification (FLS) sections",
  "type": "object",
  "required": [
    "standard",
    "standard_version",
    "fls_version",
    "mapping_date",
    "mappings"
  ],
  "properties": {
    "standard": {
      "type": "string",
      "enum": ["MISRA-C", "MISRA-C++", "CERT-C", "CERT-C++"],
      "description": "The coding standard being mapped"
    },
    "standard_version": {
      "type": "string",
      "description": "Version of the coding standard (e.g., '2025', '2023')"
    },
    "fls_version": {
      "type": "string",
      "description": "Version of the Ferrocene Language Specification used for mapping"
    },
    "mapping_date": {
      "type": "string",
      "format": "date",
      "description": "Date when the mapping was created/updated (YYYY-MM-DD)"
    },
    "methodology": {
      "type": "string",
      "description": "Description of how mappings were determined"
    },
    "statistics": {
      "type": "object",
      "description": "Summary counts of mapping status",
      "properties": {
        "total_guidelines": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of guidelines in the standard"
        },
        "mapped": {
          "type": "integer",
          "minimum": 0,
          "description": "Guidelines with FLS mappings (direct or partial)"
        },
        "unmapped": {
          "type": "integer",
          "minimum": 0,
          "description": "Guidelines awaiting mapping"
        },
        "not_applicable": {
          "type": "integer",
          "minimum": 0,
          "description": "Guidelines not applicable to Rust"
        },
        "rust_prevents": {
          "type": "integer",
          "minimum": 0,
          "description": "Guidelines where Rust's design prevents the issue"
        }
      }
    },
    "mappings": {
      "type": "array",
      "description": "Array of guideline-to-FLS mappings",
      "items": {
        "$ref": "#/$defs/mapping_entry"
      }
    }
  },
  "$defs": {
    "mapping_entry": {
      "type": "object",
      "description": "A single guideline's mapping to FLS sections",
      "required": ["guideline_id", "guideline_type", "applicability_all_rust", "applicability_safe_rust"],
      "if": {
        "properties": {
          "fls_ids": {
            "type": "array",
            "minItems": 1
          }
        },
        "required": ["fls_ids"]
      },
      "then": {
        "required": ["fls_rationale_type"]
      },
      "properties": {
        "guideline_id": {
          "type": "string",
          "description": "ID from the coding standard (e.g., 'Rule 1.1', 'MEM30-C')"
        },
        "guideline_type": {
          "type": "string",
          "enum": ["rule", "directive", "recommendation"],
          "description": "Type of guideline"
        },
        "fls_ids": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^fls_[a-zA-Z0-9]+$"
          },
          "description": "List of FLS IDs this guideline maps to (e.g., ['fls_jep7p27kaqlp'])"
        },
        "fls_sections": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Human-readable FLS section numbers and paragraphs (e.g., ['15.1', '15.1:3', '17.2'])"
        },
        "fls_rationale_type": {
          "type": "string",
          "enum": [
            "direct_mapping",
            "rust_alternative",
            "rust_prevents",
            "no_equivalent",
            "partial_mapping"
          ],
          "description": "Explains the relationship between the guideline and the FLS IDs: direct_mapping=rule maps directly to these FLS concepts, rust_alternative=Rust has a different/better mechanism (FLS shows what Rust uses instead), rust_prevents=Rust's design prevents the issue (FLS shows how), no_equivalent=C concept doesn't exist in Rust (FLS shows related Rust constructs for context), partial_mapping=some aspects map directly, others don't"
        },
        "applicability_all_rust": {
          "type": "string",
          "enum": [
            "direct",
            "partial",
            "not_applicable",
            "rust_prevents",
            "unmapped"
          ],
          "description": "How this guideline applies to ALL Rust code (including unsafe): direct=maps cleanly, partial=concept differs in Rust, not_applicable=C/C++ specific with no Rust equivalent, rust_prevents=Rust's design prevents the issue, unmapped=needs expert mapping"
        },
        "applicability_safe_rust": {
          "type": "string",
          "enum": [
            "direct",
            "partial",
            "not_applicable",
            "rust_prevents",
            "unmapped"
          ],
          "description": "How this guideline applies to SAFE Rust code only: direct=maps cleanly, partial=concept differs in Rust, not_applicable=C/C++ specific with no Rust equivalent, rust_prevents=Rust's design prevents the issue, unmapped=needs expert mapping"
        },
        "misra_rust_category": {
          "type": ["string", "null"],
          "enum": ["required", "advisory", "recommended", "disapplied", "implicit", "n_a", null],
          "description": "MISRA's adjusted category for Rust (from MISRA C:2025 ADD-6). Only applicable to MISRA standards."
        },
        "misra_rust_comment": {
          "type": ["string", "null"],
          "description": "MISRA's comment on Rust applicability (from MISRA C:2025 ADD-6). Only applicable to MISRA standards."
        },
        "confidence": {
          "type": ["string", "null"],
          "enum": ["high", "medium", "low", null],
          "description": "Confidence level in the mapping accuracy (null when unmapped)"
        },
        "notes": {
          "type": "string",
          "description": "Explanation of mapping rationale, differences from C/C++, or why not applicable"
        }
      }
    }
  }
}
